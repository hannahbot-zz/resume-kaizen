/**
 * @preserve FastClick: polyfill to remove click delays on browsers with touch UIs.
 *
 * @version 1.0.0
 * @codingstandard ftlabs-jsv2
 * @copyright The Financial Times Limited [All Rights Reserved]
 * @license MIT License (see LICENSE.txt)
 */
function FastClick(t){"use strict";function e(t,e){return function(){return t.apply(e,arguments)}}var i;this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=10,this.layer=t,FastClick.notNeeded(t)||(deviceIsAndroid&&(t.addEventListener("mouseover",e(this.onMouse,this),!0),t.addEventListener("mousedown",e(this.onMouse,this),!0),t.addEventListener("mouseup",e(this.onMouse,this),!0)),t.addEventListener("click",e(this.onClick,this),!0),t.addEventListener("touchstart",e(this.onTouchStart,this),!1),t.addEventListener("touchmove",e(this.onTouchMove,this),!1),t.addEventListener("touchend",e(this.onTouchEnd,this),!1),t.addEventListener("touchcancel",e(this.onTouchCancel,this),!1),Event.prototype.stopImmediatePropagation||(t.removeEventListener=function(e,i,n){var r=Node.prototype.removeEventListener;"click"===e?r.call(t,e,i.hijacked||i,n):r.call(t,e,i,n)},t.addEventListener=function(e,i,n){var r=Node.prototype.addEventListener;"click"===e?r.call(t,e,i.hijacked||(i.hijacked=function(t){t.propagationStopped||i(t)}),n):r.call(t,e,i,n)}),"function"==typeof t.onclick&&(i=t.onclick,t.addEventListener("click",function(t){i(t)},!1),t.onclick=null))}function commaSeparateNumber(t){for(;/(\d+)(\d{3})/.test(t.toString());)t=t.toString().replace(/(\d+)(\d{3})/,"$1,$2");return t}function restrictAlpha(t){var e;return t.metaKey||t.ctrlKey?!0:0===t.which?!0:t.which<33?!0:(e=String.fromCharCode(t.which),!!/[a-zA-Z\s]/.test(e))}function restrictAlphaNumeric(t){var e;return t.metaKey||t.ctrlKey?!0:0===t.which?!0:t.which<33?!0:(e=String.fromCharCode(t.which),!!/[a-zA-Z0-9\s]/.test(e))}function supportsTransitions(){var t=document.body||document.documentElement,e=t.style,i="transition";if("string"==typeof e[i])return!0;var n=["Moz","webkit","Webkit","Khtml","O","ms"];i=i.charAt(0).toUpperCase()+i.substr(1);for(var r=0;r<n.length;r++)if("string"==typeof e[n[r]+i])return!0;return!1}function email_check(t){var e=/^[^@]+@[^@.]+\.[^@]*\w\w$/,i=/[\(\)\<\>\,\;\:\\\"\[\]]/;return!e.test(t)||t.match(i)?!1:!0}function show_notify(t){void 0==t&&(t={}),notify_timeout&&window.clearTimeout(notify_timeout),t.type&&"error"==t.type?(ELM.notify.addClass("error"),ELM.notify.children("strong").html("Error")):(ELM.notify.removeClass("error"),ELM.notify.children("strong").html("Success")),void 0!==t.text?(ELM.notify.addClass("text"),ELM.notify.children("p").html(t.text)):ELM.notify.removeClass("text"),ELM.notify.addClass("show"),notify_timeout=window.setTimeout(function(){ELM.notify.removeClass("show")},4e3)}function ajax_error(t){var e="Error. Please try again.";if(void 0!=t.error.message)e=t.error.message;else if(void 0!=t.responseText){var i=$.parseJSON(t.responseText);i&&void 0!=i.error&&(e=i.error)}show_notify({type:"error",text:e})}function confirmation(t,e,i){i="undefined"!=typeof i?i:!0,i?$("#dialog div.options a.btn.cancel").unbind("click").click(function(){return $("#modal_bg, #dialog").hide(),e(!1),!1}).show():$("#dialog div.options a.btn.cancel").hide(),$("#dialog div.options a.btn.ok").text("OK").unbind("click").click(function(){return $("#modal_bg, #dialog").hide(),e(!0),!1}),$("#dialog div.inner").html("<p>"+t+"</p>"),$("#modal_bg, #dialog").show()}!function(t,e,i){function n(t){for(var e={x:t.offsetLeft,y:t.offsetTop};t=t.offsetParent;)e.x+=t.offsetLeft,e.y+=t.offsetTop;return e}function r(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)t[r]===i&&(t[r]=n[r])}return t}function a(t,e){for(var i in e)t.style[s(t,i)||i]=e[i];return t}function s(t,e){var n=t.style,r,a;if(n[e]!==i)return e;for(e=e.charAt(0).toUpperCase()+e.slice(1),a=0;a<d.length;a++)if(r=d[a]+e,n[r]!==i)return r}function o(t,e,i,n){var r=["opacity",e,~~(100*t),i,n].join("-"),a=.01+i/n*100,s=Math.max(1-(1-t)/e*(100-a),t),o=u.substring(0,u.indexOf("Animation")).toLowerCase(),l=o&&"-"+o+"-"||"";return p[r]||(h.insertRule("@"+l+"keyframes "+r+"{0%{opacity:"+s+"}"+a+"%{opacity:"+t+"}"+(a+.01)+"%{opacity:1}"+(a+e)%100+"%{opacity:"+t+"}100%{opacity:"+s+"}}",0),p[r]=1),r}function l(t,e,i){return i&&!i.parentNode&&l(t,i),t.insertBefore(e,i||null),t}function c(t,i){var n=e.createElement(t||"div"),r;for(r in i)n[r]=i[r];return n}var d=["webkit","Moz","ms","O"],p={},u,h=function(){var t=c("style");return l(e.getElementsByTagName("head")[0],t),t.sheet||t.styleSheet}(),f=function g(t){return this.spin?void(this.opts=r(t||{},g.defaults,m)):new g(t)},m=f.defaults={lines:12,length:7,width:5,radius:10,color:"#000",speed:1,trail:100,opacity:.25,fps:20},v=f.prototype={spin:function(t){this.stop();var e=this,i=e.el=a(c(),{position:"relative"}),r,s;if(t&&(s=n(l(t,i,t.firstChild)),r=n(i),a(i,{left:(t.offsetWidth>>1)-r.x+s.x+"px",top:(t.offsetHeight>>1)-r.y+s.y+"px"})),i.setAttribute("aria-role","progressbar"),e.lines(i,e.opts),!u){var o=e.opts,d=0,p=o.fps,h=p/o.speed,f=(1-o.opacity)/(h*o.trail/100),m=h/o.lines;!function v(){d++;for(var t=o.lines;t;t--){var n=Math.max(1-(d+t*m)%h*f,o.opacity);e.opacity(i,o.lines-t,n,o)}e.timeout=e.el&&setTimeout(v,~~(1e3/p))}()}return e},stop:function(){var t=this.el;return t&&(clearTimeout(this.timeout),t.parentNode&&t.parentNode.removeChild(t),this.el=i),this}};v.lines=function(t,e){function i(t,i){return a(c(),{position:"absolute",width:e.length+e.width+"px",height:e.width+"px",background:t,boxShadow:i,transformOrigin:"left",transform:"rotate("+~~(360/e.lines*n)+"deg) translate("+e.radius+"px,0)",borderRadius:(e.width>>1)+"px"})}for(var n=0,r;n<e.lines;n++)r=a(c(),{position:"absolute",top:1+~(e.width/2)+"px",transform:"translate3d(0,0,0)",opacity:e.opacity,animation:u&&o(e.opacity,e.trail,n,e.lines)+" "+1/e.speed+"s linear infinite"}),e.shadow&&l(r,a(i("#000","0 0 4px #000"),{top:"2px"})),l(t,l(r,i(e.color,"0 0 1px rgba(0,0,0,.1)")));return t},v.opacity=function(t,e,i){e<t.childNodes.length&&(t.childNodes[e].style.opacity=i)},function(){var t=a(c("group"),{behavior:"url(#default#VML)"}),e;if(!s(t,"transform")&&t.adj){for(e=4;e--;)h.addRule(["group","roundrect","fill","stroke"][e],"behavior:url(#default#VML)");v.lines=function(t,e){function i(t,i,s){l(o,l(a(n(),{rotation:360/e.lines*t+"deg",left:~~i}),l(a(c("roundrect",{arcsize:1}),{width:r,height:e.width,left:e.radius,top:-e.width>>1,filter:s}),c("fill",{color:e.color,opacity:e.opacity}),c("stroke",{opacity:0}))))}function n(){return a(c("group",{coordsize:s+" "+s,coordorigin:-r+" "+-r}),{width:s,height:s})}var r=e.length+e.width,s=2*r,o=n(),d=~(e.length+e.radius+e.width)+"px",p;if(e.shadow)for(p=1;p<=e.lines;p++)i(p,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(p=1;p<=e.lines;p++)i(p);return l(a(t,{margin:d+" 0 0 "+d,zoom:1}),o)},v.opacity=function(t,e,i,n){var r=t.firstChild;n=n.shadow&&n.lines||0,r&&e+n<r.childNodes.length&&(r=r.childNodes[e+n],r=r&&r.firstChild,r=r&&r.firstChild,r&&(r.opacity=i))}}else u=s(t,"animation")}(),t.Spinner=f}(window,document),$.fn.spin=function(t){return this.each(function(){var e=$(this),i=e.data();i.spinner&&(i.spinner.stop(),delete i.spinner),t!==!1&&(i.spinner=new Spinner($.extend({color:e.css("color")},t)).spin(this))}),this};var deviceIsAndroid=navigator.userAgent.indexOf("Android")>0,deviceIsIOS=/iP(ad|hone|od)/.test(navigator.userAgent),deviceIsIOS4=deviceIsIOS&&/OS 4_\d(_\d)?/.test(navigator.userAgent),deviceIsIOSWithBadTarget=deviceIsIOS&&/OS ([6-9]|\d{2})_\d/.test(navigator.userAgent);FastClick.prototype.needsClick=function(t){"use strict";switch(t.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(t.disabled)return!0;break;case"input":if(deviceIsIOS&&"file"===t.type||t.disabled)return!0;break;case"label":case"video":return!0}return/\bneedsclick\b/.test(t.className)},FastClick.prototype.needsFocus=function(t){"use strict";switch(t.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!deviceIsAndroid;case"input":switch(t.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!t.disabled&&!t.readOnly;default:return/\bneedsfocus\b/.test(t.className)}},FastClick.prototype.sendClick=function(t,e){"use strict";var i,n;document.activeElement&&document.activeElement!==t&&document.activeElement.blur(),n=e.changedTouches[0],i=document.createEvent("MouseEvents"),i.initMouseEvent(this.determineEventType(t),!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),i.forwardedTouchEvent=!0,t.dispatchEvent(i)},FastClick.prototype.determineEventType=function(t){"use strict";return deviceIsAndroid&&"select"===t.tagName.toLowerCase()?"mousedown":"click"},FastClick.prototype.focus=function(t){"use strict";var e;deviceIsIOS&&t.setSelectionRange&&0!==t.type.indexOf("date")&&"time"!==t.type?(e=t.value.length,t.setSelectionRange(e,e)):t.focus()},FastClick.prototype.updateScrollParent=function(t){"use strict";var e,i;if(e=t.fastClickScrollParent,!e||!e.contains(t)){i=t;do{if(i.scrollHeight>i.offsetHeight){e=i,t.fastClickScrollParent=i;break}i=i.parentElement}while(i)}e&&(e.fastClickLastScrollTop=e.scrollTop)},FastClick.prototype.getTargetElementFromEventTarget=function(t){"use strict";return t.nodeType===Node.TEXT_NODE?t.parentNode:t},FastClick.prototype.onTouchStart=function(t){"use strict";var e,i,n;if(t.targetTouches.length>1)return!0;if(e=this.getTargetElementFromEventTarget(t.target),i=t.targetTouches[0],deviceIsIOS){if(n=window.getSelection(),n.rangeCount&&!n.isCollapsed)return!0;if(!deviceIsIOS4){if(i.identifier===this.lastTouchIdentifier)return t.preventDefault(),!1;this.lastTouchIdentifier=i.identifier,this.updateScrollParent(e)}}return this.trackingClick=!0,this.trackingClickStart=t.timeStamp,this.targetElement=e,this.touchStartX=i.pageX,this.touchStartY=i.pageY,t.timeStamp-this.lastClickTime<200&&t.preventDefault(),!0},FastClick.prototype.touchHasMoved=function(t){"use strict";var e=t.changedTouches[0],i=this.touchBoundary;return Math.abs(e.pageX-this.touchStartX)>i||Math.abs(e.pageY-this.touchStartY)>i?!0:!1},FastClick.prototype.onTouchMove=function(t){"use strict";return this.trackingClick?((this.targetElement!==this.getTargetElementFromEventTarget(t.target)||this.touchHasMoved(t))&&(this.trackingClick=!1,this.targetElement=null),!0):!0},FastClick.prototype.findControl=function(t){"use strict";return void 0!==t.control?t.control:t.htmlFor?document.getElementById(t.htmlFor):t.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},FastClick.prototype.onTouchEnd=function(t){"use strict";var e,i,n,r,a,s=this.targetElement;if(!this.trackingClick)return!0;if(t.timeStamp-this.lastClickTime<200)return this.cancelNextClick=!0,!0;if(this.cancelNextClick=!1,this.lastClickTime=t.timeStamp,i=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,deviceIsIOSWithBadTarget&&(a=t.changedTouches[0],s=document.elementFromPoint(a.pageX-window.pageXOffset,a.pageY-window.pageYOffset)||s,s.fastClickScrollParent=this.targetElement.fastClickScrollParent),n=s.tagName.toLowerCase(),"label"===n){if(e=this.findControl(s)){if(this.focus(s),deviceIsAndroid)return!1;s=e}}else if(this.needsFocus(s))return t.timeStamp-i>100||deviceIsIOS&&window.top!==window&&"input"===n?(this.targetElement=null,!1):(this.focus(s),this.sendClick(s,t),deviceIsIOS4&&"select"===n||(this.targetElement=null,t.preventDefault()),!1);return deviceIsIOS&&!deviceIsIOS4&&(r=s.fastClickScrollParent,r&&r.fastClickLastScrollTop!==r.scrollTop)?!0:(this.needsClick(s)||(t.preventDefault(),this.sendClick(s,t)),!1)},FastClick.prototype.onTouchCancel=function(){"use strict";this.trackingClick=!1,this.targetElement=null},FastClick.prototype.onMouse=function(t){"use strict";return this.targetElement?t.forwardedTouchEvent?!0:t.cancelable&&(!this.needsClick(this.targetElement)||this.cancelNextClick)?(t.stopImmediatePropagation?t.stopImmediatePropagation():t.propagationStopped=!0,t.stopPropagation(),t.preventDefault(),!1):!0:!0},FastClick.prototype.onClick=function(t){"use strict";var e;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):"submit"===t.target.type&&0===t.detail?!0:(e=this.onMouse(t),e||(this.targetElement=null),e)},FastClick.prototype.destroy=function(){"use strict";var t=this.layer;deviceIsAndroid&&(t.removeEventListener("mouseover",this.onMouse,!0),t.removeEventListener("mousedown",this.onMouse,!0),t.removeEventListener("mouseup",this.onMouse,!0)),t.removeEventListener("click",this.onClick,!0),t.removeEventListener("touchstart",this.onTouchStart,!1),t.removeEventListener("touchmove",this.onTouchMove,!1),t.removeEventListener("touchend",this.onTouchEnd,!1),t.removeEventListener("touchcancel",this.onTouchCancel,!1)},FastClick.notNeeded=function(t){"use strict";var e,i;if("undefined"==typeof window.ontouchstart)return!0;if(i=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1]){if(!deviceIsAndroid)return!0;if(e=document.querySelector("meta[name=viewport]")){if(-1!==e.content.indexOf("user-scalable=no"))return!0;if(i>31&&window.innerWidth<=window.screen.width)return!0}}return"none"===t.style.msTouchAction?!0:!1},FastClick.attach=function(t){"use strict";return new FastClick(t)},"undefined"!=typeof define&&define.amd?define(function(){"use strict";return FastClick}):"undefined"!=typeof module&&module.exports?(module.exports=FastClick.attach,module.exports.FastClick=FastClick):window.FastClick=FastClick,function(){var t,e,i,n,r,a,s,o,l,c,d,p,u,h,f,m,v,g,y,_,C=[].slice,b=[].indexOf||function(t){for(var e=0,i=this.length;i>e;e++)if(e in this&&this[e]===t)return e;return-1},w=this;t=jQuery,t.payment={},t.payment.fn={},t.fn.payment=function(){var e,i;return i=arguments[0],e=2<=arguments.length?C.call(arguments,1):[],t.payment.fn[i].apply(this,e)},r=/(\d{1,4})/g,n=[{type:"maestro",pattern:/^(5018|5020|5038|6304|6759|676[1-3])/,format:r,length:[12,13,14,15,16,17,18,19],cvcLength:[3],luhn:!0},{type:"dinersclub",pattern:/^(36|38|30[0-5])/,format:r,length:[14],cvcLength:[3],luhn:!0},{type:"laser",pattern:/^(6706|6771|6709)/,format:r,length:[16,17,18,19],cvcLength:[3],luhn:!0},{type:"jcb",pattern:/^35/,format:r,length:[16],cvcLength:[3],luhn:!0},{type:"unionpay",pattern:/^62/,format:r,length:[16,17,18,19],cvcLength:[3],luhn:!1},{type:"discover",pattern:/^(6011|65|64[4-9]|622)/,format:r,length:[16],cvcLength:[3],luhn:!0},{type:"mastercard",pattern:/^5[1-5]/,format:r,length:[16],cvcLength:[3],luhn:!0},{type:"amex",pattern:/^3[47]/,format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[3,4],luhn:!0},{type:"visa",pattern:/^4/,format:r,length:[13,14,15,16],cvcLength:[3],luhn:!0}],e=function(t){var e,i,r;for(t=(t+"").replace(/\D/g,""),i=0,r=n.length;r>i;i++)if(e=n[i],e.pattern.test(t))return e},i=function(t){var e,i,r;for(i=0,r=n.length;r>i;i++)if(e=n[i],e.type===t)return e},u=function(t){var e,i,n,r,a,s;for(n=!0,r=0,i=(t+"").split("").reverse(),a=0,s=i.length;s>a;a++)e=i[a],e=parseInt(e,10),(n=!n)&&(e*=2),e>9&&(e-=9),r+=e;return r%10===0},p=function(t){var e;return null!=t.prop("selectionStart")&&t.prop("selectionStart")!==t.prop("selectionEnd")?!0:("undefined"!=typeof document&&null!==document&&null!=(e=document.selection)&&"function"==typeof e.createRange?e.createRange().text:void 0)?!0:!1},h=function(e){var i=this;return setTimeout(function(){var i,n;return i=t(e.currentTarget),n=i.val(),n=t.payment.formatCardNumber(n),i.val(n)})},o=function(i){var n,r,a,s,o,l,c;return a=String.fromCharCode(i.which),!/^\d+$/.test(a)||(n=t(i.currentTarget),c=n.val(),r=e(c+a),s=(c.replace(/\D/g,"")+a).length,l=16,r&&(l=r.length[r.length.length-1]),s>=l||null!=n.prop("selectionStart")&&n.prop("selectionStart")!==c.length)?void 0:(o=r&&"amex"===r.type?/^(\d{4}|\d{4}\s\d{6})$/:/(?:^|\s)(\d{4})$/,o.test(c)?(i.preventDefault(),n.val(c+" "+a)):o.test(c+a)?(i.preventDefault(),n.val(c+a+" ")):void 0)},a=function(e){var i,n;return i=t(e.currentTarget),n=i.val(),e.meta||8!==e.which||null!=i.prop("selectionStart")&&i.prop("selectionStart")!==n.length?void 0:/\d\s$/.test(n)?(e.preventDefault(),i.val(n.replace(/\d\s$/,""))):/\s\d?$/.test(n)?(e.preventDefault(),i.val(n.replace(/\s\d?$/,""))):void 0},l=function(e){var i,n,r;if(n=String.fromCharCode(e.which),/^\d+$/.test(n)){if(i=t(e.currentTarget),r=i.val()+n,/^\d$/.test(r)&&"0"!==r&&"1"!==r)return e.preventDefault(),i.val("0"+r+"/");if(/^\d\d$/.test(r))return e.preventDefault(),i.val(""+r+"/");if(/^\d\d\/\d\d$/.test(r)){e.preventDefault();var a=r.split("/");return i.val("20"!==a[1]?a[0]+"/20"+a[1]:r)}}},c=function(e){var i,n,r;return n=String.fromCharCode(e.which),/^\d+$/.test(n)?(i=t(e.currentTarget),r=i.val(),/^\d\d$/.test(r)?i.val(""+r+"/"):void 0):void 0},d=function(e){var i,n,r;return n=String.fromCharCode(e.which),"/"===n?(i=t(e.currentTarget),r=i.val(),/^\d$/.test(r)&&"0"!==r?i.val("0"+r+"/"):void 0):void 0},s=function(e){var i,n;if(!e.meta&&(i=t(e.currentTarget),n=i.val(),8===e.which&&(null==i.prop("selectionStart")||i.prop("selectionStart")===n.length)))return/\d(\s|\/)+$/.test(n)?(e.preventDefault(),i.val(n.replace(/\d(\s|\/)*$/,""))):/\/?\d?$/.test(n)?(e.preventDefault(),i.val(n.replace(/\/?\d?$/,""))):void 0},y=function(t){var e;return t.metaKey||t.ctrlKey?!0:32===t.which?!1:0===t.which?!0:t.which<33?!0:(e=String.fromCharCode(t.which),!!/[\d\s]/.test(e))},g=function(e){var i;if(e.metaKey||e.ctrlKey)return!0;if(32===e.which)return!1;if(0===e.which)return!0;if(e.which<33)return!0;i=String.fromCharCode(e.which);var n=this.value.indexOf("."),r=this.selectionStart;return"."===i&&""===this.value?!1:-1!==n&&"."===i?!1:"."===i&&r<this.value.length-2?!1:-1!==n&&n+2<this.value.length&&!p(t(e.currentTarget))?!1:!!/[0-9\.]/.test(i)},m=function(i){var n,r,a,s;return n=t(i.currentTarget),a=String.fromCharCode(i.which),/^\d+$/.test(a)&&!p(n)?(s=(n.val()+a).replace(/\D/g,""),r=e(s),r?s.length<=r.length[r.length.length-1]:s.length<=16):void 0},v=function(e){var i,n,r;return i=t(e.currentTarget),n=String.fromCharCode(e.which),/^\d+$/.test(n)&&!p(i)?(r=i.val()+n,r=r.replace(/\D/g,""),r.length>6?!1:void 0):void 0},f=function(e){var i,n,r;return i=t(e.currentTarget),n=String.fromCharCode(e.which),/^\d+$/.test(n)?(r=i.val()+n,r.length<=4):void 0},_=function(e){var i,r,a,s,o;return i=t(e.currentTarget),o=i.val(),s=t.payment.cardType(o)||"unknown",i.hasClass(s)?void 0:(r=function(){var t,e,i;for(i=[],t=0,e=n.length;e>t;t++)a=n[t],i.push(a.type);return i}(),i.removeClass("unknown"),i.removeClass(r.join(" ")),i.addClass(s),i.toggleClass("identified","unknown"!==s),i.trigger("payment.cardType",s))},t.payment.fn.formatCardCVC=function(){return this.payment("restrictNumeric"),this.on("keypress",f),this},t.payment.fn.formatCardExpiry=function(){return this.payment("restrictNumeric"),this.on("keypress",v),this.on("keypress",l),this.on("keypress",d),this.on("keypress",c),this.on("keydown",s),this},t.payment.fn.formatCardNumber=function(){return this.payment("restrictNumeric"),this.on("keypress",m),this.on("keypress",o),this.on("keydown",a),this.on("keyup",_),this.on("paste",h),this},t.payment.fn.restrictNumeric=function(){return this.on("keypress",y),this},t.payment.fn.restrictPrice=function(){return this.on("keypress",g),this},t.payment.fn.cardExpiryVal=function(){return t.payment.cardExpiryVal(t(this).val())},t.payment.cardExpiryVal=function(t){var e,i,n,r;return t=t.replace(/\s/g,""),r=t.split("/",2),e=r[0],n=r[1],2===(null!=n?n.length:void 0)&&/^\d+$/.test(n)&&(i=(new Date).getFullYear(),i=i.toString().slice(0,2),n=i+n),e=parseInt(e,10),n=parseInt(n,10),{month:e,year:n}},t.payment.validateCardNumber=function(t){var i,n;return t=(t+"").replace(/\s+|-/g,""),/^\d+$/.test(t)?(i=e(t),i?(n=t.length,b.call(i.length,n)>=0&&(i.luhn===!1||u(t))):!1):!1},t.payment.validateCardExpiry=function(e,i){var n,r,a,s;return"object"==typeof e&&"month"in e&&(s=e,e=s.month,i=s.year),e&&i?(e=t.trim(e),i=t.trim(i),/^\d+$/.test(e)&&/^\d+$/.test(i)&&parseInt(e,10)<=12?(2===i.length&&(a=(new Date).getFullYear(),a=a.toString().slice(0,2),i=a+i),r=new Date(i,e),n=new Date,r.setMonth(r.getMonth()-1),r.setMonth(r.getMonth()+1,1),r>n):!1):!1},t.payment.validateCardCVC=function(e,n){var r,a;return e=t.trim(e),/^\d+$/.test(e)?n?(r=e.length,b.call(null!=(a=i(n))?a.cvcLength:void 0,r)>=0):e.length>=3&&e.length<=4:!1},t.payment.cardType=function(t){var i;return t?(null!=(i=e(t))?i.type:void 0)||null:null},t.payment.formatCardNumber=function(t){var i,n,r,a;return(i=e(t))?(r=i.length[i.length.length-1],t=t.replace(/\D/g,""),t=t.slice(0,+r+1||9e9),i.format.global?null!=(a=t.match(i.format))?a.join(" "):void 0:(n=i.format.exec(t),null!=n&&n.shift(),null!=n?n.join(" "):void 0)):t}}.call(this);var ELM={body:$("body"),sections:$("#sections"),sections_wrap:$("#sections_wrap"),products:$("#products"),basic_info:$("#basic_info"),additional_info:$("#additional_info"),footer:$("#footer"),grand_total:$("#grand_total"),pay_btn:$("#pay_btn"),share_btn:$("#share_btn"),share_menu:$("#share_menu"),billing_address:$("#billing_address"),billing_city:$("#billing_city"),billing_state:$("#billing_state"),billing_zip:$("#billing_zip"),billing_country:$("#billing_country"),shipping_name:$("#shipping_name"),shipping_address:$("#shipping_address"),shipping_city:$("#shipping_city"),shipping_state:$("#shipping_state"),shipping_zip:$("#shipping_zip"),shipping_country:$("#shipping_country"),shipping_options:$("#shipping_options"),pay_invoice:$("#pay_invoice")},child_sections=ELM.sections_wrap.children("section"),total_sections=child_sections.length,numbers=["one","two","three","four","five"],transform_timeout=!1,calc_totals=function(){var t=_DATA.grand_total,e=$("#line_items"),i=!1;if(void 0!==_DATA.coupon){var n="percent"===_DATA.coupon.type?_DATA.before_shipping_total*(+_DATA.coupon.amount/100):+_DATA.coupon.amount,r=(+t-+n).toFixed(2);0>=r?(n=+t,t=0):t=r,e.find(".sub").html(cursym+commaSeparateNumber(_DATA.grand_total)),e.find(".coupon").html("-"+cursym+commaSeparateNumber(n.toFixed(2))).parent().removeClass("hide"),e.removeClass("hide"),i=!0}else e.find(".coupon").html("").parent().addClass("hide"),e.addClass("hide");if(ELM.grand_total.find("span").html(cursym+commaSeparateNumber(t)),tax){var a=void 0!==_DATA.coupon?(t*(tax/100)).toFixed(2):(_DATA.grand_total*(tax/100)).toFixed(2);void 0===_DATA.coupon&&e.find(".sub").html(cursym+commaSeparateNumber(t)),e.find(".tax").html(cursym+commaSeparateNumber(a)).parent().removeClass("hide"),e.removeClass("hide"),t=(+t+ +a).toFixed(2),i=!0}void 0!==_DATA.shipping_total&&(e.find(".shipping").html(cursym+commaSeparateNumber(_DATA.shipping_total)).parent().removeClass("hide"),e.removeClass("hide"),t=(+t+ +_DATA.shipping_total).toFixed(2),i=!0),i?ELM.basic_info.find("footer").addClass("add-bottom"):ELM.basic_info.find("footer").removeClass("add-bottom");var s=i?ELM.basic_info.height()-25:ELM.basic_info.height(),o=ELM.sections.attr("data-number");ELM.basic_info.attr("data-height",s),ELM.sections_wrap.css("height",ELM.sections_wrap.children("section."+numbers[o]).attr("data-height")),ELM.pay_btn.find(".amount").html(cursym+commaSeparateNumber(t))},calc_products=function(){var t=ELM.products.find("li.selected"),e=0,i=0,n={};if(t.each(function(t){var i=parseInt($(this).find(".qty .total").text()),r;$(this).hasClass("customer-price")?(r=parseFloat($(this).find("input.price").val(),10).toFixed(2),isNaN(r)&&(r=0)):r=parseFloat($(this).attr("data-price"),10).toFixed(2),e+=r*i,n[t]={id:$(this).attr("data-id"),qty:i},$(this).hasClass("customer-price")&&(n[t].amount=r)}),ELM.shipping_options.length>0){var r=parseFloat(ELM.shipping_options.find("option:selected").val(),10);isNaN(r)||void 0===r||(i=r.toFixed(2),_DATA.shipping_total=i)}_DATA.products=n,_DATA.grand_total=e.toFixed(2),calc_totals()},calc_section_dimensions=function(){for(var t=0,e=ELM.sections.width(),i=0;total_sections>i;i++)t+=e;requestAnimationFrame(function(){child_sections.css("width",e),ELM.sections_wrap.css("width",t)})},calc_section_transform=function(t){var e=t?t:parseInt(ELM.sections.attr("data-number")),i=ELM.sections.width(),n=_HAS_TRANSITIONS?{"-webkit-transform":"translate3d(-"+i*e+"px,0,0)","-moz-transform":"translate3d(-"+i*e+"px,0,0)","-ms-transform":"translate3d(-"+i*e+"px,0,0)","-o-transform":"translate3d(-"+i*e+"px,0,0)",transform:"translate3d(-"+i*e+"px,0,0)"}:{left:"-"+i*e+"px"};requestAnimationFrame(function(){ELM.sections_wrap.css(n)})},slide_sections=function(t){ELM.sections_wrap.css("height",ELM.sections_wrap.children("section."+numbers[t]).attr("data-height")),ELM.sections.attr("class",numbers[t]).attr("data-number",t),transform_timeout&&clearTimeout(transform_timeout),ELM.sections_wrap.addClass("animating"),calc_section_transform(t);var e=ELM.sections_wrap.find("section."+numbers[t]);"success_pane"===e[0].id&&ELM.footer.remove(),transform_timeout=setTimeout(function(){ELM.sections_wrap.removeClass("animating")},500)};ELM.body.click(function(t){t.target!=ELM.share_btn[0]&&0==$(t.target).parents("#share_menu").length&&ELM.share_menu.hide()}),ELM.share_btn.click(function(t){t.preventDefault(),ELM.share_menu.toggle()}),ELM.share_menu.hover(function(){},function(){$(this).fadeOut(200)}),ELM.products.on("click","li",function(t,e){if(t.preventDefault(),"INPUT"!==t.target.tagName){if($(t.target).parents(".crement").length<=0){var i=$(this).hasClass("selected"),n=ELM.products.find("li.customer-price[data-price=0]").not($(this));n.find("input.price").removeClass("error"),"preselect"!==e&&n.filter(".selected").trigger("click"),$(this).toggleClass("selected"),!i&&$(this).hasClass("customer-price")&&""===$(this).find("input.price").val()&&"preselect"!==e&&$(this).find("input.price").focus(),i?($(this).find(".qty span").text("0"),$(this).find("input.price").removeClass("error")):$(this).find(".qty span").text("1"),ELM.products.find("li.selected").length>0?ELM.footer.removeClass("pick").addClass("nav"):ELM.footer.removeClass("nav").addClass("pick")}else{var r=$(t.target).hasClass("plus")||$(t.target).parents("a").hasClass("plus")?1:-1,a=$(this).find(".qty .total"),s=parseInt(a.text()),o=0>=s+r?0:s+r;a.text(o),0===o&&$(this).removeClass("selected")}calc_products()}}).on("mousedown touchstart","li",function(t){$(t.target).parents(".crement").length<=0&&"INPUT"!=t.target.tagName&&$(this).addClass("mouse-down")}).on("mouseup touchend","li",function(t){$(this).removeClass("mouse-down")}),ELM.footer.on("click","nav a",function(t){t.preventDefault();var e=$(this).hasClass("back")?!0:!1,i=ELM.products.length>0?!0:!1,n=parseInt(ELM.sections.attr("data-number")),r=e?n-1:n+1,a=ELM.products.find("li.selected.customer-price");if(r>total_sections-1||0>r)return!1;if(a.length>0){var s=!0;if(a.find("input.price").filter(function(){var t=!1;return(""===$(this).val()||+$(this).val()<.99)&&(t=!0,s=!1),t}).addClass("error"),!s)return void $("html, body").scrollTop(a.find("input.price.error:first").offset().top-40)}if(ELM.products.find("li.selected[data-price!=0]").length>0&&ELM.products.find("li.selected.customer-price[data-price=0]").click(),_DATA.grand_total<=0&&!e&&0===n&&i)return void(a.length>0&&a.find("input.price").addClass("error"));var o=!1;if(ELM.billing_address.length>0&&!e&&ELM.sections_wrap.find("section."+numbers[n]+" #billing_address").length>0){var l=$("#billing_city"),c=$("#billing_state"),d=$("#billing_zip"),p=$("#billing_country");""==ELM.billing_address.val()&&(ELM.billing_address.addClass("error"),o=!0),""==l.val()&&(l.addClass("error"),o=!0),""==c.val()&&(c.addClass("error"),o=!0),""==d.val()&&(d.addClass("error"),o=!0),""==p.siblings("input").val()&&(p.parent().addClass("error"),o=!0)}if(ELM.shipping_address.length>0&&!e&&ELM.sections_wrap.find("section."+numbers[n]+" #shipping_address").length>0){var u=$("#shipping_name"),h=$("#shipping_city"),f=$("#shipping_state"),m=$("#shipping_zip"),v=$("#shipping_country");""==ELM.shipping_address.val()&&(ELM.shipping_address.addClass("error"),o=!0),""==u.val()&&(u.addClass("error"),o=!0),""==h.val()&&(h.addClass("error"),o=!0),""==f.val()&&(f.addClass("error"),o=!0),""==m.val()&&(m.addClass("error"),o=!0),""==v.siblings("input").val()&&(v.parent().addClass("error"),o=!0)}if(ELM.shipping_options.length>0&&!e&&ELM.sections_wrap.find("section."+numbers[n]+" #shipping_options").length>0){var g=ELM.shipping_options.find("option:selected").val();(""===g||void 0===g)&&(ELM.shipping_options.parent().addClass("error"),o=!0)}if(ELM.additional_info.length>0&&!e&&ELM.sections_wrap.find("section."+numbers[n]+"#additional_info").length>0&&ELM.additional_info.find(".data-field").filter(function(){var t=!1;return("email"===$(this).attr("type")&&""!==$(this).val()&&!email_check($(this).val())||"number"===$(this).attr("type")&&""!==$(this).val()&&!$(this).val().match(/^\d+(?:\.\d+)?$/)||void 0!==$(this).attr("required")&&""===$(this).val())&&(t=!0,o=!0),t}).addClass("error"),o){if(ELM.additional_info.length>0){var y=ELM.additional_info.find(".data-field.error:first");y.length>0&&$("html, body").scrollTop(y.offset().top-40)}}else ELM.products.length>0&&setTimeout(function(){var t=ELM.products.offset().top,e=parseInt(document.body.scrollTop),i,n=function(){t>=e||(i=requestAnimationFrame(n),window.scrollTo(0,e),e-=10)};n()},300),slide_sections(r),0>=r?$(this).parent().removeClass("back"):r>=total_sections-2&&$(this).parent().removeClass("next"),r>0&&$(this).parent().addClass("back"),(total_sections-2>r||0===r)&&$(this).parent().addClass("next")}),$("#cancel_preorder_btn").click(function(t){if(t.preventDefault(),confirm("Your order will be permanently cancelled and your card will not be charged. Ok?")){var e=$(this),i=e.outerWidth(),n=e.html();e.html("&nbsp;").css("width",i).addClass("stale").spin({lines:10,length:5,width:2,radius:6,color:"#ccc",speed:1,trail:40,shadow:!1}),$.ajax({type:"DELETE",url:base_url+"api/pre_orders/"+preorder_id,success:function(){show_notify({text:"Pre Order Canceled"}),ELM.footer.remove()},error:function(t){e.html(n).removeAttr("style").removeClass("stale"),ajax_error(t)}})}}),$("#change_cc_slide").click(function(t){t.preventDefault(),slide_sections(1)}),$("#change_cc_btn").click(function(t){var e=$(this);if(!e.hasClass("stale")){var i=e.outerWidth(),n=e.html();e.html("&nbsp;").css("width",i).addClass("stale").spin({lines:10,length:5,width:2,radius:6,color:"#fff",speed:1,trail:40,shadow:!1});var r=!1,a=$("#customer_name"),s=$("#cc_number"),o=$("#cc_exp"),l=$("#cc_cvc"),c=a.val(),d=s.val(),p=o.val(),u=l.val(),h=d.slice(-4),f=$.payment.cardType(d);""===c?(show_notify({type:"error",text:"Please enter your Name"}),a.addClass("error"),r=!0):Stripe.validateCardNumber(d)?Stripe.validateExpiry(p.split("/")[0],p.split("/")[1])?Stripe.validateCVC(u)||(show_notify({type:"error",text:"Please enter a valid CVC number"}),l.addClass("error"),r=!0):(show_notify({type:"error",text:"Please enter a valid Expiration Date"}),o.addClass("error"),r=!0):(show_notify({type:"error",text:"Please enter a valid Credit Card Number"}),s.addClass("error"),r=!0);var m={name:c,email:CUSTOMER.email,number:d,cvc:u,exp_month:p.split("/")[0],exp_year:p.split("/")[1]};r?e.html(n).removeAttr("style").removeClass("stale"):Stripe.createToken(m,function(t,i){i.error?(e.html(n).removeAttr("style").removeClass("stale"),show_notify({type:"error",text:"Could not validate your card. Please try again."})):$.ajax({type:"PUT",url:base_url+"api/customers/"+CUSTOMER.id,data:JSON.stringify({cc_type:f,cc_last4:h}),success:function(t){e.html(n).removeAttr("style").removeClass("stale"),show_notify({text:"Card Updated."}),o.add(l).add(s).val(""),ELM.footer.find("p").html("You <strong>"+f+"</strong> card ending in <strong>"+h+"</strong> will be charged."),slide_sections(0)},error:function(t){e.html(n).removeAttr("style").removeClass("stale"),ajax_error(t)}})})}return!1}),isEmbed&&($(window).load(function(){window.parent.postMessage("ready","*")}),$("#close_embed").click(function(){return ELM.body.removeClass("ready"),window.parent.postMessage("remove","*"),!1})),ELM.body.on("keypress",".data-field[data-type=letters]",function(t){return restrictAlpha(t)}),ELM.body.on("keypress",".data-field[data-type=alpha]",function(t){return restrictAlphaNumeric(t)
}),$(".data-field[data-type=email]").blur(function(){var t=$(this).val();email_check(t)||""===t?$(this).removeClass("error"):$(this).addClass("error")}),$(window).resize(function(){calc_section_dimensions(),calc_section_transform(!1)}),$(function(){FastClick.attach(document.body),calc_section_dimensions();var t,e;ELM.sections_wrap.children("section").each(function(i){var n=$(this).height();$(this).attr("data-height",n),0==i&&(t=n),e=n});var i=isEmbed&&e>t?e:t;ELM.sections_wrap.css("height",i),ELM.body.addClass("ready"),ELM.products.length>0&&ELM.products.find("li.preselect").trigger("click",["preselect"])}),void 0===document.createElement("input").placeholder&&(ELM.body.addClass("no-placeholder"),$(".input-cluster").on("focus","input",function(){$(this).parent().addClass("focus")}).on("blur","input",function(){""===$(this).val()&&$(this).parent().removeClass("focus")})),document.addEventListener("touchstart",function(){},!0),function(){for(var t=0,e=["ms","moz","webkit","o"],i=0;i<e.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[e[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[i]+"CancelAnimationFrame"]||window[e[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,i){var n=(new Date).getTime(),r=Math.max(0,16-(n-t)),a=window.setTimeout(function(){e(n+r)},r);return t=n+r,a}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}();var _HAS_TRANSITIONS=supportsTransitions();"undefined"==typeof ELM&&(ELM={}),$.ajaxSetup({dataType:"json",contentType:"application/json"}),$("body").on("blur","input.error",function(){""!==$(this).val()&&$(this).removeClass("error")}),ELM.notify=$("#notify"),ELM.notify.click(function(t){$(this).removeClass("show"),t.preventDefault()});var notify_timeout=!1;jQuery.extend({stringify:function t(e){var i=typeof e;if("object"!=i||null===e)return"string"==i&&(e='"'+e+'"'),String(e);var n,r,a=[],s=e&&e.constructor==Array;for(n in e)r=e[n],i=typeof r,e.hasOwnProperty(n)&&("string"==i?r='"'+r+'"':"object"==i&&null!==r&&(r=jQuery.stringify(r)),a.push((s?"":'"'+n+'":')+String(r)));return(s?"[":"{")+String(a)+(s?"]":"}")}}),ELM.body.on("keydown",".no-tab",function(t){9==t.which&&t.preventDefault()}),ELM.basic_info.on("keyup","input.price",function(){var t=parseFloat($(this).val(),10).toFixed(2);_DATA.grand_total=t,ELM.pay_btn.find(".amount").text(commaSeparateNumber(cursym+t))}),ELM.products.on("keyup","li input.price",function(){var t=$(this).parents("li:first");!t.hasClass("selected")&&""!==$(this).val()||t.hasClass("selected")&&""===$(this).val()?t.click():calc_products()}).on("blur","li input.price",function(){var t=""===$(this).val()?0:$(this).val();$(this).parents("li:first").attr("data-price",t)}),ELM.sections.on("change","label.dropdown select",function(){$(this).siblings("input[type=text]").val($(this).find("option:selected").text())}).on("focus","label.dropdown select",function(){$(this).siblings("input[type=text]").add($(this).parent()).addClass("focus")}).on("blur","label.dropdown select",function(){$(this).siblings("input[type=text]").removeClass("focus"),$(this).siblings("input[type=text]").val($(this).find("option:selected").text())}),ELM.shipping_options.prop("selectedIndex",-1).change(function(){calc_products()}),$("select").change(function(){$(this).parent().removeClass("error")}),$("input[type=number]").on("mousewheel",function(t){t.preventDefault()}),ELM.additional_info.find("input[type=number]").payment("restrictNumeric"),$("input.price").payment("restrictPrice"),$("#cc_number").payment("formatCardNumber"),$("#cc_exp").payment("formatCardExpiry"),$("#cc_cvc").payment("formatCardCVC"),$("#coupon_code").blur(function(){var t=$(this),e=t.val(),i=t.attr("data-value");t.attr("data-value",e),""!==e&&e.length<6&&i!=e?(delete _DATA.coupon,t.parent().removeClass("success").addClass("fail"),calc_totals(),show_notify({type:"error",text:"Invalid Coupon Code."})):""!==e&&e.length>6&&i!=e?$.ajax({type:"POST",url:base_url+"api/verify_coupon",data:JSON.stringify({coupon:e,space_url:url_name}),success:function(e){_DATA.coupon=e,t.parent().removeClass("fail").addClass("success"),calc_totals()},error:function(e){delete _DATA.coupon,t.parent().removeClass("success").addClass("fail"),calc_totals(),ajax_error(e)}}):""===e&&(t.parent().removeClass("success fail"),delete _DATA.coupon,calc_totals())});var dd_countries=ELM.sections.find("label.dropdown select.country");dd_countries.length>0,$("#sameas").click(function(){$(this).is(":checked")&&(ELM.shipping_name.val(ELM.shipping_name.val()),ELM.shipping_address.val(ELM.billing_address.val()),ELM.shipping_city.val(ELM.billing_city.val()),ELM.shipping_state.val(ELM.billing_state.val()),ELM.shipping_zip.val(ELM.billing_zip.val()),ELM.shipping_country.val(ELM.billing_country.val()),""!=ELM.billing_country.siblings("input[type=text]").val()&&ELM.shipping_country.siblings("input[type=text]").val(ELM.billing_country.find("option:selected").text()))}),ELM.pay_btn.click(function(){var t=$(this);if(!t.hasClass("stale")){var e=t.outerWidth(),i=t.html();t.html("&nbsp;").css("width",e).addClass("stale").spin({lines:10,length:5,width:2,radius:6,color:"#fff",speed:1,trail:40,shadow:!1});var n=!1,r=$("#customer_name"),a=$("#customer_email"),s=$("#cc_number"),o=$("#cc_exp"),l=$("#cc_cvc"),c=$("#customer_price"),d=$("#payment_token"),p=$("#user_fund"),u=$("#coupon_code"),h=r.val(),f=a.val(),m=s.val(),v=o.val(),g=l.val(),y=c.length>0?c.val():!1,_=ELM.shipping_options.length>0?ELM.shipping_options.find("option:selected").val():!1,C=d.length>0?d.val():!1,b=p.length>0?p.find("option:selected").val():!1;if("invoice"===page_type){""===h?(show_notify({type:"error",text:"Please enter your Name"}),r.addClass("error"),n=!0):Stripe.validateCardNumber(m)?Stripe.validateExpiry(v.split("/")[0],v.split("/")[1])?Stripe.validateCVC(g)||(show_notify({type:"error",text:"Please enter a valid CVC number"}),l.addClass("error"),n=!0):(show_notify({type:"error",text:"Please enter a valid Expiration Date"}),o.addClass("error"),n=!0):(show_notify({type:"error",text:"Please enter a valid Credit Card Number"}),s.addClass("error"),n=!0);var w={name:h,email:invoicee.email,number:m,cvc:g,exp_month:v.split("/")[0],exp_year:v.split("/")[1],address_line1:invoicee.address,address_city:invoicee.city,address_state:invoicee.state,address_zip:invoicee.zip,address_country:invoicee.country}}else{""!==h||C?email_check(f)||C?c.length>0&&(!y.match(/^\d+(?:\.\d+)?$/)||""===y)?(show_notify({type:"error",text:"Please enter a valid Charge Amount"}),c.addClass("error"),n=!0):c.length>0&&100>100*y?(show_notify({type:"error",text:"Charge Amount must be at least "+currency_symbol+"0.99"}),c.addClass("error"),n=!0):""===b&&C?(show_notify({type:"error",text:"You must choose a Credit Card"}),n=!0):Stripe.validateCardNumber(m)||C?Stripe.validateExpiry(v.split("/")[0],v.split("/")[1])||C?Stripe.validateCVC(g)||C||(show_notify({type:"error",text:"Please enter a valid CVC number"}),l.addClass("error"),n=!0):(show_notify({type:"error",text:"Please enter a valid Expiration Date"}),o.addClass("error"),n=!0):(show_notify({type:"error",text:"Please enter a valid Credit Card Number"}),s.addClass("error"),n=!0):(show_notify({type:"error",text:"You must enter a valid Email"}),a.addClass("error"),n=!0):(show_notify({type:"error",text:"Please enter your Name"}),r.addClass("error"),n=!0);var w=C?{token:C,card:b}:{name:h,email:f,number:m,cvc:g,exp_month:v.split("/")[0],exp_year:v.split("/")[1]}}if(ELM.billing_address.length>0){var E=ELM.billing_address.val(),L=ELM.billing_city.val(),k=ELM.billing_state.val(),M=ELM.billing_zip.val(),x=ELM.billing_country.val();""==E||""==L||""==k||""==M||""==x?(n||show_notify({type:"error",text:"Please fill out all billing address fields."}),n=!0):(w.address_line1=E,w.address_state=k,w.address_zip=M,w.address_country=x,w.address_city=L)}if(ELM.shipping_address.length>0){var T=ELM.shipping_name.val();shipping_address=ELM.shipping_address.val(),shipping_city=ELM.shipping_city.val(),shipping_state=ELM.shipping_state.val(),shipping_zip=ELM.shipping_zip.val(),shipping_country=ELM.shipping_country.val(),(""==T||""==shipping_address||""==shipping_city||""==shipping_state||""==shipping_zip||""==shipping_country)&&(n||show_notify({type:"error",text:"Please fill out all shipping address fields."}),n=!0)}var S=!1;if(ELM.additional_info.length>0&&(S=[],ELM.additional_info.find(".data-field").each(function(t){var e=$(this).val();"email"!=$(this).attr("type")||email_check(e)||""===e||(n||(show_notify({type:"error",text:"Enter a valid email in the "+$(this).attr("data-name")+" field."}),$(this).addClass("error")),n=!0),"number"!=$(this).attr("type")||e.match(/^\d+(?:\.\d+)?$/)||(n||(show_notify({type:"error",text:"Only numbers are allowed in the "+$(this).attr("data-name")+" field."}),$(this).addClass("error")),n=!0),void 0!==$(this).attr("required")&&""==e&&(n||(show_notify({type:"error",text:"Please fill out the "+$(this).attr("data-name")+" field."}),$(this).addClass("error")),n=!0),S[t]={},S[t].id=$(this).attr("data-id"),S[t].value=e})),n)t.html(i).removeAttr("style").removeClass("stale");else{var A=function(e){if("invoice"===page_type)var n={invoice:invoice_url,token:e};else{var n={name:h,email:f};if("space"===page_type?n.space=url_name:"payme"===page_type&&(n.payme=payme_email),e?n.token=e:(n.token=w.token,n.fund=w.fund),y&&(n.amount=y),$.isEmptyObject(_DATA.products)||(n.products=_DATA.products),"undefined"!=typeof E&&(n.billing_address=E,n.billing_city=L,n.billing_state=k,n.billing_zip=M,n.billing_country=x),"undefined"!=typeof shipping_address&&(n.shipping_name=T,n.shipping_address=shipping_address,n.shipping_city=shipping_city,n.shipping_state=shipping_state,n.shipping_zip=shipping_zip,n.shipping_country=shipping_country),_&&(n.shipping_option=_),S&&(n.data_fields=S),u.length>0){var r=u.val();""!==r&&u.parent().hasClass("success")&&(n.coupon=r)}}$.ajax({type:"POST",url:base_url+"api/payments",data:JSON.stringify(n),success:function(e){t.html(i).removeAttr("style").removeClass("stale");var n=$("#success_pane");if(void 0!==e&&void 0!==e.count){for(var r="",a=1===e.count?"Downloadable File":"Downloadable Files",s=0;s<e.count;s++){var o=e.items[s];r+='<li><a href="'+o.file_url+'" class="download-btn push" target="_blank"><span>Download</span></a><div class="info"><span class="title">'+o.name+"</span></div></li>"}n.html('<div class="inner"><h2>Thanks for your payment!</h2><p>A receipt will be emailed to you shortly.</p></div><ul class="item-list no-border"><li><div class="heading">'+a+"</div><ul>"+r+"</ul></li></ul>")}else n.html('<div class="inner"><h2>Thanks for your payment!</h2><p>A receipt will be emailed to you shortly.</p></div>');""!=return_url&&(void 0!==e&&void 0!==e.count?n.append('<div class="cont-holder"><hr><a href="'+return_url+'" class="btn continue">Continue</a></div>'):(n.append('<div class="inner"><a href="'+return_url+'" class="btn">Continue</a></div>'),setTimeout(function(){window.location=return_url},6e3))),n.attr("data-height",n.outerHeight()),slide_sections(parseInt(ELM.sections.attr("data-number"))+1)},error:function(e){t.html(i).removeAttr("style").removeClass("stale"),ajax_error(e)}})};C?A(!1):Stripe.createToken(w,function(e,n){n.error?(t.html(i).removeAttr("style").removeClass("stale"),show_notify({type:"error",text:"Could not validate your card. Please try again."})):A(n.id)})}}return!1});